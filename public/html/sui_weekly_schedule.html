<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å²å·±SUIçš„å‘¨è¡¨ - 2025.11.17~11.23</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&family=Noto+Serif+SC:wght@400;500;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans SC', sans-serif;
            background: linear-gradient(135deg, #fdf6e3 0%, #f4f1e8 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 20px;
        }

        .schedule-container {
            width: 900px;
            min-height: 600px;
            background: #faf7f0;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(139, 69, 19, 0.1);
            border: 2px solid rgba(160, 82, 45, 0.1);
            display: flex;
            position: relative;
            overflow: visible;
        }

        .schedule-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image:
                radial-gradient(circle at 20% 80%, rgba(255, 218, 185, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 228, 181, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .left-section {
            flex: 2;
            padding: 30px 30px 40px 30px;
            position: relative;
            z-index: 1;
        }

        .title {
            font-family: 'Noto Serif SC', serif;
            font-size: 32px;
            font-weight: 700;
            color: #8B4513;
            margin-bottom: 8px;
            text-align: center;
        }

        .subtitle {
            font-size: 14px;
            color: #A0522D;
            text-align: center;
            margin-bottom: 30px;
            font-weight: 300;
        }

        .date-range {
            background: rgba(210, 180, 140, 0.2);
            padding: 8px 15px;
            border-radius: 15px;
            font-size: 13px;
            color: #8B4513;
            text-align: center;
            margin-bottom: 25px;
            font-weight: 500;
        }

        .schedule-table {
            width: 100%;
        }

        .schedule-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 16px;
            padding: 10px 15px;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .schedule-item:hover {
            background: rgba(255, 228, 181, 0.15);
            transform: translateX(5px);
        }

        .day-label {
            width: 50px;
            font-size: 16px;
            font-weight: 600;
            color: #A0522D;
            text-align: center;
            margin-right: 20px;
        }

        .date-label {
            display: inline-block;
            margin-top: 6px;
            font-size: 11px;
            color: #C08B5A;
            font-weight: 400;
        }

        .day-label.rest {
            color: #D2691E;
            font-weight: 500;
        }

        .schedule-content {
            flex: 1;
            font-size: 14px;
            color: #5D4E37;
            line-height: 1.3;
        }

        .schedule-content .emoji {
            font-size: 16px;
            margin-right: 8px;
        }

        .rest-day {
            background: rgba(210, 180, 140, 0.1);
            opacity: 0.7;
        }

        .right-section {
            flex: 1;
            padding: 30px 20px 40px 20px;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: stretch;
            position: relative;
            z-index: 1;
            gap: 20px;
        }

        .memo-section {
            background: rgba(255, 239, 213, 0.8);
            border-radius: 15px;
            padding: 20px;
            border: 2px dashed rgba(160, 82, 45, 0.3);
            margin-bottom: 20px;
        }

        .memo-title {
            font-size: 16px;
            font-weight: 600;
            color: #8B4513;
            margin-bottom: 10px;
            text-align: center;
        }

        .memo-content {
            font-size: 12px;
            color: #5D4E37;
            line-height: 1.5;
            font-style: italic;
        }

        .character-section {
            text-align: center;
            position: relative;
        }

        .character {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, #FFE4B5 0%, #F4A460 100%);
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 50px;
            box-shadow: 0 8px 20px rgba(160, 82, 45, 0.2);
            animation: float 3s ease-in-out infinite;
            overflow: hidden;
        }

        .character.character-image,
        .character.character-svg {
            padding: 0;
            background: rgba(255, 234, 208, 0.9);
        }

        .character.character-emoji {
            font-size: 50px;
        }

        .character img,
        .character svg {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-8px);
            }
        }

        .character-name {
            font-size: 14px;
            font-weight: 600;
            color: #8B4513;
            margin-bottom: 5px;
        }

        .character-tag {
            font-size: 11px;
            color: #A0522D;
            background: rgba(255, 228, 181, 0.5);
            padding: 3px 10px;
            border-radius: 12px;
            display: inline-block;
        }

        .weekly-note {
            background: rgba(255, 228, 181, 0.3);
            padding: 15px;
            border-radius: 12px;
            border-left: 4px solid #D2691E;
        }

        .weekly-note-title {
            font-size: 13px;
            font-weight: 600;
            color: #8B4513;
            margin-bottom: 8px;
        }

        .weekly-note-content {
            font-size: 11px;
            color: #5D4E37;
            line-height: 1.4;
        }

        .special-highlight {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2) 0%, rgba(255, 165, 0, 0.2) 100%);
            border: 1px solid rgba(255, 165, 0, 0.4);
        }

        .special-highlight.highlight-noodle {
            background: linear-gradient(135deg, rgba(255, 228, 196, 0.85) 0%, rgba(255, 204, 153, 0.6) 100%);
            border-color: rgba(222, 149, 81, 0.7);
            box-shadow: 0 10px 25px rgba(222, 149, 81, 0.25);
        }

        .special-highlight.highlight-sun {
            background: linear-gradient(135deg, rgba(255, 250, 205, 0.9) 0%, rgba(255, 239, 213, 0.7) 100%);
            border-color: rgba(255, 215, 0, 0.6);
            box-shadow: 0 10px 25px rgba(255, 215, 0, 0.25);
        }

        .special-highlight.highlight-festival {
            background: linear-gradient(135deg, rgba(255, 182, 193, 0.85) 0%, rgba(255, 105, 180, 0.55) 100%);
            border-color: rgba(255, 105, 180, 0.65);
            box-shadow: 0 10px 25px rgba(255, 105, 180, 0.2);
        }

        .feather-decoration {
            position: absolute;
            color: rgba(255, 228, 181, 0.6);
            font-size: 20px;
            animation: featherFloat 4s ease-in-out infinite;
        }

        @keyframes featherFloat {

            0%,
            100% {
                transform: translateY(0px) rotate(0deg);
                opacity: 0.6;
            }

            50% {
                transform: translateY(-15px) rotate(10deg);
                opacity: 0.8;
            }
        }

        .feather-decoration:nth-child(1) {
            top: 10%;
            right: 10%;
            animation-delay: 0s;
        }

        .feather-decoration:nth-child(2) {
            top: 60%;
            right: 5%;
            animation-delay: 1s;
        }

        .feather-decoration:nth-child(3) {
            top: 80%;
            right: 15%;
            animation-delay: 2s;
        }
    </style>
</head>

<body>
    <div class="schedule-container">
        <!-- è£…é¥°æ€§ç¾½æ¯› -->
        <div class="feather-decoration">ğŸª¶</div>
        <div class="feather-decoration">ğŸª¶</div>
        <div class="feather-decoration">ğŸª¶</div>

        <div class="left-section">
            <h1 class="title">å²å·±SUIçš„å‘¨è¡¨</h1>
            <div class="subtitle">å°é¥¼å¹²çš„æŠ•å–‚æ—¶é—´è¡¨ ğŸ“…ï¼ˆçº¯å±çŒœæµ‹ï¼Œå…·ä½“æ—¶é—´ä¸å›ºå®šï¼‰</div>

            <div class="date-range">
                2025.11.17 ~ 11.23
            </div>

            <div class="schedule-table" id="schedule-table">
                <div class="schedule-item">
                    <div class="day-label">åŠ è½½ä¸­</div>
                    <div class="schedule-content">
                        <span class="emoji">â³</span>æ­£åœ¨æ ¹æ®è®¾å®šè®¡ç®—æœ¬å‘¨çš„æ´»åŠ¨...
                    </div>
                </div>
            </div>
        </div>

        <div class="right-section">
            <div class="memo-section">
                <div class="memo-title">ä»Šæ—¥é”è¯„ ğŸ’­</div>
                <div class="memo-content">
                    "åˆåˆ°äº†å°é¥¼å¹²ä»¬æœŸå¾…çš„æ—¶é—´å•¦~ <br>æœ¬å‘¨æœ‰ç‰¹åˆ«çš„ç…®é¢å›ï¼Œè®°å¾—å‡†æ—¶æ¥å¬æˆ‘çš„æ¸©æŸ”åŠ©çœ å“¦ï¼<br><br>æ¸¸æˆå›åªèƒ½è¯´æˆ‘æœ‰ç‚¹ç¬¨ç¬¨ï¼ğŸ˜¤"
                </div>
            </div>

            <div class="character-section">
                <div class="character character-emoji" id="character-visual" role="img" aria-label="å²å·±SUI">ğŸ¦</div>
                <div class="character-name">å²å·±SUI</div>
                <div class="character-tag">å°é¸Ÿå…¬ä¸»</div>
            </div>

            <div class="weekly-note">
                <div class="weekly-note-title">æ–°é¥¼é¡»çŸ¥ âœ¨</div>
                <div class="weekly-note-content">
                    â€¢ ä¸Šäº”ä¼‘ä¸€ï¼Œæ¯å‘¨ä¸å›ºå®š<br>
                    â€¢ æ²¡æœ‰ä¸“é—¨æ­Œå›ï¼Œä½†æ¯å¤©ä¼šå”±æ­Œ<br>
                    â€¢ å‘¨ä¸‰22:00ç…®é¢å›ç‰¹åˆ«å®‰æ’<br>
                    â€¢ å‘¨æ—¥ä¼šä¸‹åˆæ’­<br>
                    â€¢ æ¸¸æˆæ‰“å¾—å¾ˆå¯çˆ±
                </div>
            </div>
        </div>
    </div>

    <script id="schedule-config">
        window.scheduleConfig = {
            timezone: 'Asia/Shanghai',
            weekStart: 1,
            restCopy: 'ä¼‘æ¯æ—¥ - å…»ç²¾è“„é”ï¼Œä¸‹å‘¨è§ï¼',
            fallbackCopy: 'è‡ªç”±è°ƒä¼‘ï¼Œçµæ„Ÿå¾…æœºä¸­ï½',
            restRule: {
                workDays: 5,
                restDays: 1,
                anchorDate: null,
                anchorIsRest: false
            },
            restOverrides: {
                '2025-11-17': true,
            },
            specialActivities: [
                {
                    date: '2025-11-20',
                    // highlight: true,
                    activities: [
                        { emoji: 'ğŸµ', text: '19:40 å”±æ­ŒèŠå¤© 2å°æ—¶æš–åœº' },
                        { emoji: 'ğŸ¬', text: '21:40 çœ‹ã€Šå¤§è¯è¥¿æ¸¸ä¹‹æœˆå…‰å®ç›’ã€‹' }
                    ]
                },
                {
                    date: '2025-11-21',
                    // highlight: true,
                    activities: [
                        { emoji: 'ğŸµ', text: '19:40 å”±æ­ŒèŠå¤© 2å°æ—¶æš–åœº' },
                        { emoji: 'ğŸ¬', text: '21:40 çœ‹ã€Šå¤§è¯è¥¿æ¸¸ä¹‹å¤§åœ£å¨¶äº²ã€‹' }
                    ]
                },
                {
                    date: '2025-11-22',
                    highlight: 'noodle',
                    activities: [
                        { emoji: 'ğŸµ', text: '14:40 ä¸‹åˆæ’­~å”±å”±èŠèŠ~' },
                        { emoji: 'ğŸ¬', text: '16:40 ç©ã€Šé©¬é‡Œå¥¥é“¶æ²³ã€‹' }
                    ]
                },
                {
                    date: '2025-11-23',
                    // highlight: 'noodle',
                    activities: [
                        { emoji: 'ğŸµ', text: '14:40 å°æ’­ä¸€ä¸‹~ä»Šå¤©å±…ç„¶ä¸ä¼‘æ¯å“¦~' },
                    ]
                }
            ],
            weeklyFixed: {
                3: {
                    highlight: 'sun',
                    activities: [
                        { emoji: 'ğŸŒ™', text: '22:00 ç…®é¢å› (3Däººå¤´éº¦åŠ©çœ )' },
                        { emoji: 'ğŸœ', text: 'æ¸©æŸ”åŠ©çœ ï¼Œä¼´éšå…¥çœ ' }
                    ]
                },
                7: {
                    // highlight: 'sun',
                    activities: [
                        { emoji: 'â˜€ï¸', text: '14:30 ä¸‹åˆæ’­ï¼Œå”±å”±èŠèŠ~' }
                    ]
                }
            },
            defaultTemplates: [
                {
                    weekdays: [2, 4, 5, 6],
                    activities: [
                        { emoji: 'ğŸµ', text: '19:40 å”±æ­ŒèŠå¤© 2å°æ—¶' }
                    ]
                }
            ],
            rotationSlots: [
                {
                    weekdays: [2, 4, 5, 6],
                    pool: [
                        [
                            { emoji: 'ğŸ®', text: 'ç„¶åç©æ˜Ÿä¹‹å¡æ¯” 2å°æ—¶' }
                        ],
                        [
                            { emoji: 'ğŸ¬', text: 'ç„¶åçœ‹TOP250ç”µå½± 2å°æ—¶' }
                        ]
                    ],
                    startIndex: 0,
                    countTowardsRotation: true
                }
            ],
            characterPool: [
                {
                    type: 'image',
                    src: '/images/sui-bird-jump.png',
                    alt: 'å²å·±SUIè·³è·³é¸Ÿ',
                    name: 'å²å·±SUI',
                    tag: 'è·³è·³å°é¸Ÿ'
                },
                {
                    type: 'image',
                    src: '/images/wiki/sui_clothes_stand.png',
                    alt: 'å²å·±SUIå°é¸Ÿç«‹ç»˜',
                    tag: 'å…ƒæ°”å¾¡é¸Ÿ',
                    objectPosition: 'center 15%'
                },
                {
                    type: 'image',
                    src: '/images/wiki/sui_charactor_half_body.png',
                    alt: 'å²å·±åŠèº«åƒ',
                    tag: 'å°çŒ«å¸½~'
                },
                {
                    type: 'emoji',
                    emoji: 'ğŸ¦',
                    name: 'å²å·±SUI',
                    tag: 'å°é¸Ÿå…¬ä¸»'
                },
                {
                    type: 'image',
                    src: '/images/wiki/killmanybird.jpg',
                    alt: 'å²å·±å‡»æ€å¤šåè™è ',
                    tag: 'é¬¼æ€é˜ŸÂ·é¸Ÿä¹‹å‘¼å¸',
                    objectPosition: 'center 15%',
                    transform: 'scale(1.3) translateX(-4%)'
                }
            ]
        };
    </script>

    <script>
        (function () {
            'use strict';

            const DAY_LABELS = ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­', 'å‘¨æ—¥'];
            const MS_IN_DAY = 24 * 60 * 60 * 1000;

            const config = window.scheduleConfig || {};
            const urlParams = new URLSearchParams(window.location.search);
            const weekParam = urlParams.get('week');
            const today = getToday(config.timezone);
            const referenceDate = resolveReferenceDate(weekParam, today);
            const weekDates = getWeekDates(referenceDate, config.weekStart || 1);
            const anchorDate = getRestAnchorDate(config) || weekDates[0];
            const schedule = buildSchedule(weekDates, config, anchorDate);

            updateMeta(weekDates, { previewNote: getPreviewNote(weekParam, referenceDate, today) });
            renderSchedule(schedule);
            renderCharacterVisual(config);

            function getToday(timezone) {
                if (!timezone) {
                    return stripTime(new Date());
                }
                const formatter = new Intl.DateTimeFormat('en-CA', {
                    timeZone: timezone,
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit'
                });
                return stripTime(new Date(formatter.format(new Date())));
            }

            function stripTime(date) {
                return new Date(date.getFullYear(), date.getMonth(), date.getDate());
            }

            function getWeekDates(reference, weekStart) {
                const startIndex = Math.min(Math.max(weekStart, 1), 7);
                const currentWeekday = reference.getDay() === 0 ? 7 : reference.getDay();
                const diff = currentWeekday - startIndex;
                const weekStartDate = new Date(reference);
                weekStartDate.setDate(reference.getDate() - diff);
                const result = [];
                for (let i = 0; i < 7; i++) {
                    const day = new Date(weekStartDate);
                    day.setDate(weekStartDate.getDate() + i);
                    result.push(day);
                }
                return result;
            }

            function formatDateDisplay(date) {
                const y = date.getFullYear();
                const m = String(date.getMonth() + 1).padStart(2, '0');
                const d = String(date.getDate()).padStart(2, '0');
                return `${y}.${m}.${d}`;
            }

            function formatISODate(date) {
                const y = date.getFullYear();
                const m = String(date.getMonth() + 1).padStart(2, '0');
                const d = String(date.getDate()).padStart(2, '0');
                return `${y}-${m}-${d}`;
            }

            function getRestAnchorDate(cfg) {
                if (cfg.restRule && cfg.restRule.anchorDate) {
                    return new Date(cfg.restRule.anchorDate);
                }
                const specials = (cfg.specialActivities || []).slice().sort((a, b) => new Date(a.date) - new Date(b.date));
                if (specials.length) {
                    return new Date(specials[specials.length - 1].date);
                }
                return null;
            }

            function buildSchedule(dates, cfg, anchor) {
                const specialMap = new Map((cfg.specialActivities || []).map(item => [item.date, item]));
                const weeklyFixed = normalizeWeeklyFixed(cfg.weeklyFixed || {});
                const restOverrides = cfg.restOverrides || {};
                const defaultTemplates = cfg.defaultTemplates || [];
                const rotationSlots = (cfg.rotationSlots || []).map((slot, index) => ({
                    ...slot,
                    state: slot.startIndex || 0,
                    index
                }));

                return dates.map(date => {
                    const iso = formatISODate(date);
                    const weekdayIndex = date.getDay() === 0 ? 7 : date.getDay();
                    const special = specialMap.get(iso);
                    const override = restOverrides.hasOwnProperty(iso) ? restOverrides[iso] : undefined;
                    const isRest = special
                        ? false
                        : typeof override === 'boolean'
                            ? override
                            : shouldRest(date, anchor, cfg.restRule);

                    const base = {
                        date,
                        iso,
                        weekdayIndex,
                        dayLabel: DAY_LABELS[weekdayIndex - 1],
                        dateDisplay: formatDateDisplay(date),
                        activities: [],
                        isRest,
                        highlight: false,
                        highlightType: null
                    };

                    if (isRest) {
                        base.activities = [{
                            emoji: 'ğŸ˜´',
                            text: cfg.restCopy || 'ä¼‘æ¯æ—¥ - è°ƒæ•´çŠ¶æ€ï¼Œçµæ„Ÿè“„åŠ›ä¸­ï¼'
                        }];
                        return base;
                    }

                    if (special) {
                        base.activities = cloneActivities(special.activities || []);
                        applyHighlight(base, special.highlight);
                        return base;
                    }

                    if (weeklyFixed[weekdayIndex]) {
                        const weeklyConfig = weeklyFixed[weekdayIndex];
                        base.activities.push(...cloneActivities(weeklyConfig.activities || []));
                        applyHighlight(base, weeklyConfig.highlight);
                    }

                    defaultTemplates.forEach(template => {
                        if ((template.weekdays || []).includes(weekdayIndex)) {
                            base.activities.push(...cloneActivities(template.activities || []));
                        }
                    });

                    rotationSlots.forEach(slot => {
                        if ((slot.weekdays || []).includes(weekdayIndex)) {
                            if (slot.prefix) {
                                base.activities.push(...cloneActivities(slot.prefix));
                            }
                            const pool = slot.pool || [];
                            if (pool.length) {
                                const selection = pool[slot.state % pool.length] || [];
                                base.activities.push(...cloneActivities(selection));
                                if (slot.countTowardsRotation !== false) {
                                    slot.state++;
                                }
                            }
                        }
                    });

                    if (!base.activities.length) {
                        base.activities.push({
                            emoji: 'ğŸŒ€',
                            text: cfg.fallbackCopy || 'å¾…æœºä¸­ï¼Œéšç¼˜å¼€æ’­~'
                        });
                    }

                    return base;
                });
            }

            function normalizeWeeklyFixed(source) {
                return Object.entries(source).reduce((acc, [key, value]) => {
                    if (Array.isArray(value)) {
                        acc[Number(key)] = { activities: value };
                    } else if (value && typeof value === 'object') {
                        const activities = Array.isArray(value.activities) ? value.activities : [];
                        acc[Number(key)] = {
                            activities,
                            highlight: value.highlight
                        };
                    }
                    return acc;
                }, {});
            }

            function cloneActivities(list) {
                return (list || []).map(item => ({ emoji: item.emoji || 'â€¢', text: item.text || '' }));
            }

            function shouldRest(date, anchor, rule = {}) {
                if (!anchor || !rule) return false;
                const workDays = Math.max(1, rule.workDays || 5);
                const restDays = Math.max(1, rule.restDays || 1);
                const cycle = workDays + restDays;
                const anchorIsRest = !!rule.anchorIsRest;
                const diff = Math.floor((stripTime(date) - stripTime(anchor)) / MS_IN_DAY);
                const offset = anchorIsRest ? workDays : 0;
                const normalized = mod(diff - offset, cycle);
                return normalized === workDays;
            }

            function mod(value, divisor) {
                const result = value % divisor;
                return result >= 0 ? result : result + divisor;
            }

            function updateMeta(dates, options = {}) {
                const rangeText = `${formatDateDisplay(dates[0])} ~ ${formatDateDisplay(dates[dates.length - 1])}`;
                const suffix = options.previewNote ? ` Â· ${options.previewNote}` : '';
                const rangeEl = document.querySelector('.date-range');
                if (rangeEl) {
                    rangeEl.textContent = `${rangeText}${suffix}`;
                }
                document.title = `å²å·±SUIçš„å‘¨è¡¨ - ${rangeText}${options.previewNote ? ` (${options.previewNote})` : ''}`;
            }

            function applyHighlight(target, value) {
                if (!value) return;
                target.highlight = true;
                target.highlightType = typeof value === 'string' ? value : 'default';
            }

            function renderSchedule(data) {
                const container = document.getElementById('schedule-table');
                if (!container) return;
                container.innerHTML = '';

                data.forEach(day => {
                    const item = document.createElement('div');
                    item.className = 'schedule-item';
                    item.dataset.date = day.iso;

                    if (day.isRest) {
                        item.classList.add('rest-day');
                    }
                    if (day.highlight) {
                        item.classList.add('special-highlight');
                        if (day.highlightType) {
                            item.classList.add(`highlight-${day.highlightType}`);
                        }
                    }

                    const label = document.createElement('div');
                    label.className = `day-label${day.isRest ? ' rest' : ''}`;
                    label.innerHTML = `${day.dayLabel}<span class="date-label">${day.dateDisplay}</span>`;

                    const content = document.createElement('div');
                    content.className = 'schedule-content';

                    day.activities.forEach(activity => {
                        const row = document.createElement('div');
                        row.innerHTML = `<span class="emoji">${activity.emoji || 'â€¢'}</span>${activity.text || ''}`;
                        content.appendChild(row);
                    });

                    item.appendChild(label);
                    item.appendChild(content);
                    container.appendChild(item);
                });
            }

            function renderCharacterVisual(cfg = {}) {
                const pool = getCharacterPool(cfg);
                if (!pool.length) return;
                const target = document.getElementById('character-visual');
                if (!target) return;

                const pick = pool[Math.floor(Math.random() * pool.length)];
                if (!pick) return;

                const nameEl = document.querySelector('.character-name');
                const tagEl = document.querySelector('.character-tag');

                target.innerHTML = '';
                target.classList.remove('character-image', 'character-emoji', 'character-svg');

                if (pick.type === 'image' && pick.src) {
                    const img = document.createElement('img');
                    img.src = pick.src;
                    img.alt = pick.alt || pick.name || 'å²å·±SUIéšæœºå½¢è±¡';
                    if (pick.objectPosition) {
                        img.style.objectPosition = pick.objectPosition;
                    }
                    if (pick.transform) {
                        img.style.transform = pick.transform;
                    }
                    if (pick.styles && typeof pick.styles === 'object') {
                        Object.entries(pick.styles).forEach(([key, value]) => {
                            if (value !== undefined && value !== null) {
                                img.style[key] = value;
                            }
                        });
                    }
                    target.appendChild(img);
                    target.classList.add('character-image');
                } else if (pick.type === 'svg' && pick.content) {
                    target.innerHTML = pick.content;
                    target.classList.add('character-svg');
                } else {
                    target.textContent = pick.emoji || pick.content || 'ğŸ¦';
                    target.classList.add('character-emoji');
                }

                if (pick.name && nameEl) {
                    nameEl.textContent = pick.name;
                }
                if (pick.tag && tagEl) {
                    tagEl.textContent = pick.tag;
                }
                target.setAttribute('aria-label', pick.alt || pick.name || 'å²å·±SUI');
            }

            function getCharacterPool(cfg = {}) {
                if (cfg.characterPool && cfg.characterPool.length) {
                    return cfg.characterPool;
                }
                return [
                    { type: 'emoji', emoji: 'ğŸ¦', name: 'å²å·±SUI', tag: 'å°é¸Ÿå…¬ä¸»' }
                ];
            }

            function resolveReferenceDate(param, today) {
                if (!param) return today;
                const trimmed = String(param).trim();
                if (!trimmed) return today;
                const normalized = trimmed.toLowerCase();

                if (normalized === 'next') {
                    return addDays(today, 7);
                }
                if (normalized === 'prev' || normalized === 'previous') {
                    return addDays(today, -7);
                }

                const weekOffsetMatch = normalized.match(/^([+-]?\d+)w$/);
                if (weekOffsetMatch) {
                    const offset = Number(weekOffsetMatch[1]);
                    if (!Number.isNaN(offset)) {
                        return addDays(today, offset * 7);
                    }
                }

                const dayOffsetMatch = normalized.match(/^([+-]?\d+)d$/);
                if (dayOffsetMatch) {
                    const offset = Number(dayOffsetMatch[1]);
                    if (!Number.isNaN(offset)) {
                        return addDays(today, offset);
                    }
                }

                const parsed = parseDateParam(trimmed);
                if (parsed) {
                    return parsed;
                }

                return today;
            }

            function parseDateParam(value) {
                const normalized = value.replace(/\./g, '-');
                const match = normalized.match(/^(\d{4})-(\d{1,2})-(\d{1,2})$/);
                if (!match) return null;
                const [, y, m, d] = match;
                const year = Number(y);
                const month = Number(m) - 1;
                const day = Number(d);
                const candidate = new Date(year, month, day);
                if (
                    Number.isNaN(candidate.getTime()) ||
                    candidate.getFullYear() !== year ||
                    candidate.getMonth() !== month ||
                    candidate.getDate() !== day
                ) {
                    return null;
                }
                return stripTime(candidate);
            }

            function addDays(date, amount) {
                const result = new Date(date);
                result.setDate(result.getDate() + Number(amount || 0));
                return stripTime(result);
            }

            function getPreviewNote(param, referenceDate, today) {
                if (!param) return '';
                const trimmed = String(param).trim();
                if (!trimmed) return '';
                if (referenceDate.getTime() === today.getTime()) {
                    return '';
                }

                const normalized = trimmed.toLowerCase();
                if (normalized === 'next') return 'é¢„è§ˆï¼šä¸‹å‘¨';
                if (normalized === 'prev' || normalized === 'previous') return 'é¢„è§ˆï¼šä¸Šå‘¨';

                const weekOffsetMatch = normalized.match(/^([+-]?\d+)w$/);
                if (weekOffsetMatch) {
                    const offset = Number(weekOffsetMatch[1]);
                    if (!Number.isNaN(offset) && offset !== 0) {
                        return offset > 0 ? `é¢„è§ˆï¼š+${offset}å‘¨` : `é¢„è§ˆï¼š${offset}å‘¨`;
                    }
                }

                const dayOffsetMatch = normalized.match(/^([+-]?\d+)d$/);
                if (dayOffsetMatch) {
                    const offset = Number(dayOffsetMatch[1]);
                    if (!Number.isNaN(offset) && offset !== 0) {
                        return offset > 0 ? `é¢„è§ˆï¼š+${offset}å¤©` : `é¢„è§ˆï¼š${offset}å¤©`;
                    }
                }

                return `é¢„è§ˆï¼š${formatDateDisplay(referenceDate)} æ‰€åœ¨å‘¨`;
            }
        })();
    </script>
</body>

</html>